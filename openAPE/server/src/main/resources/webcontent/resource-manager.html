<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>openAPE</title>
    <script>
        var serveraddress = "http://localhost:8080/server-0.1-SNAPSHOT";

        function uploadFile() {
            var resData = new FormData();
            resData.append("resourceFile", document.getElementById("resourceInput").files[0]);

            var req = new XMLHttpRequest();
            req.open("POST", serveraddress + "/api/resource", true);
            req.send(resData);
            console.log("resource sent");
            req.onreadystatechange = function () {
                console.log(req.readyState, ", ", req.status);
                if (req.readyState === 4 && req.status === 201) {
                    var resourceName = req.responseText;
                    console.log("resource name: ", resourceName);
                    uploadDescription(resourceName);
                }
            }
        }

        function uploadDescription(resourceName) {

            var json = '{"propertys":[{"name": "resource_name","value": "'+resourceName+'}';
            var properties = "";
            var data = {};
            var tableBody = document.getElementById("keyValues");
            var tablerows = Array.prototype.slice.call(tableBody.getElementsByTagName("tr"));
            console.log("tablerows: ", tablerows);
            for (var i=0; i< tablerows.length; i++){
                var tabled = Array.prototype.slice.call(tablerows[i].getElementsByTagName("td"));
                console.log(tabled);
                var name = tabled[0].getElementsByTagName("input")[0].value;
                var value = tabled[1].getElementsByTagName("input")[0].value;
                console.log(name, value);
                json += ',{"name": "'+name+'","value": "'+value+'"}';
            }
            json += ']}';
            alert(json);

            var req = new XMLHttpRequest();
            req.open("POST", serveraddress + "/api/resource-description", true);
            req.send(json);
            console.log("description sent: ", json);
        }

    </script>
</head>
<body>
<table>
    <thead>
        <tr>
            <td>Name</td>
            <td>Value</td>
        </tr>
    </thead>
    <tbody id="keyValues">
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
    </tbody>
</table>
<button type="button" id="createJson" onclick="uploadFile()">Speichern</button><br>
<input type="file" id="resourceInput" name="resourceFile">

<!--<button onclick="showName()">ShowName</button>-->
</body>
</html>