<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>openAPE</title>
    <script>
        var serveraddress = "http://localhost:8080/server-0.1-SNAPSHOT";

        function uploadFile() {
            var resData = new FormData();
            resData.append("resourceFile", document.getElementById("resourceInput").files[0]);

            var req = new XMLHttpRequest();
            req.open("POST", serveraddress + "/api/resource", true);
            req.send(resData);
            console.log("resource sent");
            req.onreadystatechange = function () {
                console.log("Point1");
                console.log("Status: ",req.status);
                console.log("readyState: ",req.readyState);
                if (req.readyState === 4 && req.status === 201) {
                    console.log("Point2");
                    var resourceName = req.getResponseHeader('Location');
                    console.log("resource name: ", resourceName);
                    uploadDescription(resourceName);
                }
            }
        }

        function uploadDescription(resourceName) {
            var json = [];
            var resName = {"name": resourceName};
            json.push(resName);
            $('tbody tr').each(function () {
                var data = {},
                    $td = $(this).find('td input'),
                    key = $td.eq(0).val(),
                    value = $td.eq(1).val();
                data[key] = value;
                json.push(data);
            });
            alert(JSON.stringify(json));

            var req = new XMLHttpRequest();
            req.open("POST", serveraddress + "/api/resource-description", true);
            req.send(JSON.stringify(json));
            console.log("description sent: ", JSON.stringify(json));
        }

    </script>
</head>
<body>
<table>
    <thead>
        <tr>
            <td>Name</td>
            <td>Value</td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
        <tr>
            <td><input type="text"></td>
            <td><input type="text"></td>
        </tr>
    </tbody>
</table>
<button type="button" id="createJson" onclick="uploadFile()">Speichern</button><br>
<input type="file" id="resourceInput" name="resourceFile">

<!--<button onclick="showName()">ShowName</button>-->
</body>
</html>